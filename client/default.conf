# /etc/nginx/conf.d/default.conf
server {
    listen 8080;
    server_name localhost;

    # 1) React 정적 파일 서빙
    #    (이미 Dockerfile에서 /usr/share/nginx/html 을 기본 root로 설정했음)
    location / {
        # If you're using "try_files", it typically looks like:
        try_files $uri /index.html;
    }

    # 2) /api 로 들어오는 요청을 Express 서버로 프록시
    location /api {
        # docker-compose.yml 기준 server의 컨테이너 이름이 "express_server" 이므로,
        # 내부 DNS로 http://express_server:3001 에 접근 가능
        proxy_pass http://express_server:3001;

        # 추가로 WebSocket, 헤더 등 세부 옵션을 잡아줄 수 있음
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
    }
}
